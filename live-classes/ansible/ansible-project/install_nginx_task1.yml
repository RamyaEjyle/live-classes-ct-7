---
- name: Install Nginx and Apache on MySQL Server
  hosts: mysql
  become: yes  # Run tasks as sudo
  tasks:
    - name: Install Nginx
      ansible.builtin.yum:
        name: nginx
        state: present

    - name: Write Nginx installation status to file
      ansible.builtin.lineinfile:
        path: /tmp/sw_status.txt
        line: "nginx installed successfully!!"
        create: yes

    - name: Install Apache (httpd for RHEL)
      ansible.builtin.yum:
        name: httpd
        state: present

    - name: Append Apache installation status to file
      ansible.builtin.lineinfile:
        path: /tmp/sw_status.txt
        line: "apache installed successfully!!"

    - name: Stop Nginx to free port 80
      ansible.builtin.service:
        name: nginx
        state: stopped

    - name: Refresh service facts
      ansible.builtin.service_facts:

    - name: Start Apache only if Nginx is stopped
      ansible.builtin.service:
        name: httpd
        state: started
      when: ansible_facts.services["nginx.service"]["state"] == "stopped"
